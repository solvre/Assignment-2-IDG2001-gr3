{% extends "base.html" %}

{% block title %}Posts by {{ user.username }}{% endblock %}

{% block header %}Posts by {{ user.username }}{% endblock %}

{% block content %}
    <div id="posts">
        {% for post in posts %}
            <div class="post">
                <h3>{{ post.category }}</h3>
                <p><strong>{{ post.subject }}</strong></p>
                <p>{{ post.text }}</p>
                <p><small>Posted by {{ user.username }} on {{ post.date }}</small></p>
                <p>Likes: <span id="likes-{{ post.id }}">{{ post.likes }}</span></p>
                {% if session.session_token %}
                    <button onclick="likePost({{ post.id }})" class="like-button">&#128077;</button>
                    {% if post.user_id == session['user_id'] %}
                        <button onclick="deletePost({{ post.id }})" class="delete-button">Delete</button>
                    {% endif %}
                {% endif %}
            </div>
        {% endfor %}
    </div>

    <script>
        function likePost(postId) {
            fetch(`/like_post/${postId}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                }
            }).then(response => response.json())
            .then(data => {
                if (data.message) {
                    document.getElementById(`likes-${postId}`).innerText = data.likes;
                }
            });
        }

        function deletePost(postId) {
            fetch(`/delete_post/${postId}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                }
            }).then(response => response.json())
            .then(data => {
                if (data.message) {
                    location.reload();
                }
            });
        }
    </script>
{% endblock %}
